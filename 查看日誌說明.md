# 如何查看日誌

## 目前日誌系統的運作方式

系統使用統一的日誌系統（`logger.py`），目前日誌會輸出到：
- **終端機（Terminal）**：所有日誌都會顯示在執行程式的終端機視窗中
- **標準輸出（stdout）**：INFO、Debug、Warning 訊息
- **標準錯誤（stderr）**：Error 訊息

## 查看日誌的方法

### 方法 1：直接在終端機查看（即時）

如果程式正在運行，日誌會直接顯示在終端機中：

```bash
cd /home/pw/ProWaveDAQ_Python_Visualization_Unit
./run.sh
# 或
cd src
python3 main.py
```

### 方法 2：將日誌保存到檔案（推薦）

使用重定向將日誌保存到檔案，方便後續查看：

```bash
# 保存所有日誌（包含 INFO、Debug、Warning、Error）
cd /home/pw/ProWaveDAQ_Python_Visualization_Unit
./run.sh > logs/app.log 2>&1

# 或分別保存標準輸出和錯誤
./run.sh > logs/app.log 2> logs/error.log
```

**建議的日誌檔案結構：**
```bash
# 建立日誌目錄
mkdir -p logs

# 執行並保存日誌（使用日期命名）
./run.sh > logs/app_$(date +%Y%m%d_%H%M%S).log 2>&1
```

### 方法 3：使用 `tee` 同時顯示和保存

```bash
./run.sh 2>&1 | tee logs/app.log
```

這樣可以：
- 在終端機即時看到日誌
- 同時保存到檔案

### 方法 4：使用 `tail` 即時查看日誌檔案

如果日誌已經保存到檔案，可以使用 `tail` 即時查看：

```bash
# 查看最新的日誌
tail -f logs/app.log

# 查看最後 100 行
tail -n 100 logs/app.log

# 查看包含特定關鍵字的日誌
tail -f logs/app.log | grep "Error"
```

### 方法 5：使用 `journalctl`（如果使用 systemd）

如果程式是作為 systemd 服務運行：

```bash
# 查看服務日誌
journalctl -u prowavedaq -f

# 查看最近的日誌
journalctl -u prowavedaq -n 100
```

## 日誌級別說明

系統提供四種日誌級別：

- **`[INFO]`** - 一般資訊訊息（如：檔案建立、連線成功）
- **`[Debug]`** - 調試訊息（可透過 `Logger.set_debug_enabled(False)` 關閉）
- **`[Warning]`** - 警告訊息（如：資料長度不一致）
- **`[Error]`** - 錯誤訊息（如：連線失敗、寫入錯誤）

## 日誌格式

所有日誌訊息都包含時間戳記，格式為：
```
[YYYY-MM-DD HH:MM:SS] [LEVEL] 訊息內容
```

範例：
```
[2025-11-24 23:21:58] [INFO] New CSV file created: 20251124232158_ThisIsMe_001.csv
[2025-11-24 23:21:58] [Debug] Modbus connection established successfully.
[2025-11-24 23:22:00] [Warning] Large device update during read: requested=60096, actual=60576, diff=480
[2025-11-24 23:22:09] [Error] Failed to read data length
```

## 過濾日誌

### 使用 `grep` 過濾特定級別

```bash
# 只查看錯誤訊息
grep "\[Error\]" logs/app.log

# 只查看警告訊息
grep "\[Warning\]" logs/app.log

# 只查看 INFO 訊息
grep "\[INFO\]" logs/app.log

# 排除 Debug 訊息
grep -v "\[Debug\]" logs/app.log
```

### 使用 `grep` 過濾特定關鍵字

```bash
# 查看所有與 CSV 相關的日誌
grep "CSV" logs/app.log

# 查看所有與 Modbus 相關的日誌
grep "Modbus" logs/app.log

# 查看所有與 SQL 相關的日誌
grep "SQL" logs/app.log
```

## 建議的日誌管理腳本

可以建立一個腳本來管理日誌：

```bash
#!/bin/bash
# save_logs.sh

LOG_DIR="logs"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
LOG_FILE="${LOG_DIR}/app_${TIMESTAMP}.log"

mkdir -p ${LOG_DIR}

echo "Starting application with logging to ${LOG_FILE}"
cd /home/pw/ProWaveDAQ_Python_Visualization_Unit
./run.sh 2>&1 | tee ${LOG_FILE}
```

## 注意事項

1. **日誌檔案大小**：長時間運行會產生大量日誌，建議定期清理或使用日誌輪轉
2. **磁碟空間**：確保有足夠的磁碟空間保存日誌
3. **Debug 訊息**：如果不需要 Debug 訊息，可以在程式中關閉：
   ```python
   from logger import Logger
   Logger.set_debug_enabled(False)
   ```

## 未來改進建議

可以考慮改進日誌系統，讓它同時：
1. 輸出到終端機
2. 寫入日誌檔案
3. 支援日誌輪轉（log rotation）
4. 支援日誌級別過濾

